import { pool as db } from '../db.js';

class CoinsController {
    async addCoins(req, res) {
        const { user_id, coins } = req.body;

        const user = await db.query(`UPDATE person SET coins = coins + $1 where id = $2 RETURNING coins`, [coins, user_id]);

        res.json(user.rows[0])
    }

    async sendCoins(req, res) {
        const user_id = req.headers['x-user-id'];
        const { send_to_id, coins } = req.body;

        const senderCoins = await db.query(`UPDATE person SET coins = coins - $1 WHERE id = $2 RETURNING coins, username`, [coins, user_id]);

        await db.query(`UPDATE person SET coins = coins + $1 WHERE id = $2`, [coins, send_to_id]);

        sendMessageToChat(send_to_id, `ðŸ’° @${senderCoins.rows[0].username} Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» Ð²Ð°Ð¼ ${Number(coins).toFixed(1)} Ð¼Ð¾Ð½ÐµÑ‚Ð¾Ðº!`);

        res.json(senderCoins.rows[0].coins)
    }
}

export { CoinsController };
